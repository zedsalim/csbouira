const toggleDarkMode=()=>{document.documentElement.classList.toggle("dark"),document.querySelectorAll(".dark-mode-icon").forEach(e=>{e.classList.toggle("fa-moon"),e.classList.toggle("fa-sun")}),localStorage.setItem("darkMode",document.documentElement.classList.contains("dark"))};"true"===localStorage.getItem("darkMode")&&(document.documentElement.classList.add("dark"),document.querySelectorAll(".dark-mode-icon").forEach(e=>{e.classList.remove("fa-moon"),e.classList.add("fa-sun")}));const API_BASE="https://api.csbouira.xyz/api/drive",YEARS={licence:["Licence 1","Licence 2","Licence 3 SI"],master1:["Master 1 GSI","Master 1 ISIL","Master 1 IA"],master2:["Master 2 GSI","Master 2 ISIL","Master 2 IA"]},yearList=[...YEARS.licence,...YEARS.master1,...YEARS.master2];let currentPath=[],currentYear="",currentFiles=[],currentFileIndex=-1,onlineResources={};const loadYears=async()=>{try{renderYearCards(YEARS.licence,"licence-cards","fas fa-book-open"),renderYearCards(YEARS.master1,"master1-cards","fas fa-graduation-cap"),renderYearCards(YEARS.master2,"master2-cards","fas fa-user-graduate"),await loadAllFileCounts(),await loadOnlineResources()}catch(e){console.error("Error loading years:",e)}},renderYearCards=(e,t,n)=>{document.getElementById(t).innerHTML=e.map(e=>`\n        <div class="card p-6 cursor-pointer relative group" onclick="openYear('${e}')">\n          <span id="badge-${e.replace(/\s+/g,"-").toLowerCase()}" \n                class="absolute top-3 right-3 bg-blue-500 text-white text-xs font-semibold px-2 py-1 rounded-full shadow">\n            <div class="loading-small"></div>\n          </span>\n          \n          <div class="flex items-center gap-4 mb-4">\n            <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center">\n              <i class="${n} text-white text-xl"></i>\n            </div>\n            <h3 class="text-xl font-semibold">${e}</h3>\n          </div>\n          <p class="text-sm text-gray-500 dark:text-gray-400">\n            Click to explore semesters and modules\n          </p>\n          <div class="mt-4 flex items-center text-blue-500 font-semibold">\n            View Resources <i class="fas fa-arrow-right ml-2"></i>\n          </div>\n        </div>\n      `).join("")},loadAllFileCounts=async()=>{try{const e=await fetch(`${API_BASE}?path=_fileCounts`),t=await e.json();if(!t||"object"!=typeof t)return console.warn("No valid _fileCounts data received"),void yearList.forEach(e=>showBadge(e,null));yearList.forEach(e=>{const n=t[e];showBadge(e,void 0!==n?n:null)})}catch(e){console.error("Error loading file counts:",e),yearList.forEach(e=>showBadge(e,null))}},loadOnlineResources=async()=>{try{const e=await fetch(`${API_BASE}?path=_onlineResources`);onlineResources=await e.json()}catch(e){console.error("Failed to load _onlineResources:",e),onlineResources={}}},showBadge=(e,t)=>{const n=document.getElementById(`badge-${e.replace(/\s+/g,"-").toLowerCase()}`);n&&(n.innerHTML=null==t?'<i class="fa-solid fa-file"></i> –':`<i class="fa-solid fa-file"></i> ${t}`)},openYear=async(e,t)=>{t&&t.preventDefault(),currentYear=e,currentPath=[e];document.getElementById("yearModalTitle").innerHTML=`\n      <div class="flex items-center gap-3">\n        <span class="text-xl font-semibold">${e}</span>\n        <a \n          href="#" \n          id="driveLink" \n          title="Open in Google Drive"\n          class="hidden sm:inline-flex items-center gap-1.5 \n                 px-2.5 py-1 text-xs \n                 sm:gap-2 sm:px-3 sm:py-1.5 sm:text-sm\n                 rounded-md bg-blue-500\n                 text-white font-medium shadow-md\n                 hover:shadow-lg hover:opacity-90 transition-all duration-200"\n        >\n          <i class="fab fa-google-drive text-base sm:text-lg"></i>\n          <span class="hidden xs:inline sm:inline">Open in Drive</span>\n        </a>\n      </div>\n  `,document.getElementById("yearModal").classList.add("active"),updateBodyScrollLock(),await loadContent(e)},loadContent=async(e,t="")=>{const n=document.getElementById("yearContent");n.innerHTML='\n    <div class="text-center py-8">\n      <div class="loading mx-auto"></div>\n      <p class="mt-4">Loading...</p>\n    </div>\n  ';try{let n=`${API_BASE}?year=${encodeURIComponent(e)}`;t&&(n=`${API_BASE}?path=${encodeURIComponent(t)}`);const a=await fetch(n),s=await a.json(),o=document.getElementById("driveLink");s.link?(o.href=s.link,o.style.display="inline-flex",o.target="_blank",o.classList.add("active")):(o.style.display="none",o.classList.remove("active")),updateBreadcrumb(),renderContent(s),1===currentPath.length&&insertOnlineResources(e)}catch(e){n.innerHTML=`\n      <div class="empty-state">\n        <i class="fas fa-exclamation-circle text-6xl text-red-500 mb-4"></i>\n        <p class="text-xl">Error loading content</p>\n        <p class="mt-2">${e.message}</p>\n      </div>\n    `}},updateBreadcrumb=()=>{document.getElementById("breadcrumb").innerHTML=currentPath.map((e,t)=>`\n        <span class="breadcrumb-item ${t===currentPath.length-1?"active":""}" onclick="navigateToBreadcrumb(${t})">\n          ${e}\n          ${t<currentPath.length-1?'<i class="fas fa-chevron-right mx-2"></i>':""}\n        </span>\n      `).join("")},navigateToBreadcrumb=e=>{currentPath=currentPath.slice(0,e+1);const t=currentPath.join(">subfolders>");loadContent(currentYear,t)},renderContent=e=>{const t=document.getElementById("yearContent");if(!(e.subfolders&&0!==Object.keys(e.subfolders).length||e.files&&0!==e.files.length))return void(t.innerHTML='\n      <div class="empty-state">\n        <i class="fas fa-folder-open text-6xl mb-4" style="color: var(--text-secondary-light);"></i>\n        <p class="text-xl">No content available</p>\n      </div>\n    ');let n="";if(e.subfolders&&Object.keys(e.subfolders).length>0){n+='\n      <div class="mb-6">\n        <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">\n          <i class="fas fa-folder text-yellow-500"></i>Folders\n        </h3>\n        <div class="space-y-2">\n    ';const t=Object.entries(e.subfolders);for(const[e]of t){const t=e.includes("(empty)"),a=e.replace(/'/g,"\\'").replace(/"/g,'\\"'),s={type:"folder",name:e,year:currentYear,path:[...currentPath,e].join(">subfolders>"),folderPath:[...currentPath,e]};n+=`\n        <div class="folder-item ${t?"opacity-50":""}" ${t?"":`onclick="openFolder('${a}')"`}>\n          <i class="fas fa-folder text-yellow-500"></i>\n          <span class="flex-1">${e}</span>\n          ${t?'<span class="text-sm">(empty)</span>':("function"==typeof createStarButton?createStarButton(s):"")+'<i class="fas fa-chevron-right"></i>'}\n        </div>\n      `}n+="</div></div>"}e.files&&e.files.length>0&&(currentFiles=e.files,n+='\n      <div>\n        <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">\n          <i class="fas fa-file text-blue-500"></i>Files\n        </h3>\n        <div class="space-y-2">\n    ',e.files.forEach(e=>{const t=getFileIcon(e.name),a=JSON.stringify(e).replace(/'/g,"\\'"),s={type:"file",name:e.name,year:currentYear,path:[...currentPath,e.name].join(">subfolders>"),folderPath:[...currentPath],link:e.link||"",previewLink:e.previewLink||"",downloadLink:e.downloadLink||""};n+=`\n        <div class="file-item group">\n          <div class="flex items-center gap-3 flex-1" onclick='openFile(${a})'>\n            <i class="${t}"></i>\n            <span class="flex-1">${e.name}</span>\n            <i class="action-btn fas fa-eye"></i>\n          </div>\n          ${"function"==typeof createStarButton?createStarButton(s):""}\n          <button \n            onclick='event.stopPropagation(); downloadFile("${e.downloadLink}", "${e.name}")' \n            class="action-btn ml-2"\n            title="Download file">\n            <i class="fas fa-download"></i>\n          </button>\n        </div>\n      `}),n+="</div></div>"),t.innerHTML=n},insertOnlineResources=e=>{let t=onlineResources[e];if(!t)return;let n={};if(Array.isArray(t)?n.General=t:"object"==typeof t&&(n=t),0===Object.keys(n).length)return;const a=document.getElementById("yearContent"),s=`\n    <div class="mt-8">\n      <div class="mb-6">\n\n        <h3 class="text-lg md:text-xl font-semibold mb-4 flex items-center gap-2">\n          <i class="fas fa-globe text-red-500"></i>Videos & Websites\n        </h3>\n\n        <div class="space-y-2">\n          ${Object.entries(n).map(([e,t])=>`\n            <div class="folder-item">\n              <button \n                class="w-full flex justify-between items-center text-sm md:text-base"\n                onclick="this.parentElement.nextElementSibling.classList.toggle('hidden'); this.querySelector('.chevron-icon').classList.toggle('rotate-180');"\n              >\n                <span class="flex items-center gap-2">\n                  ${e}\n                </span>\n                <i class="fas fa-chevron-down chevron-icon transition-transform"></i>\n              </button>\n            </div>\n\n            <div class="hidden ml-2 space-y-2 mb-2">\n              ${(Array.isArray(t)?t:[]).map(e=>`\n                    <div class="border-b p-3 rounded-lg hover:shadow-md transition-shadow">\n                      <a href="${e.url||"#"}" target="_blank" class="font-semibold hover:underline text-xs md:text-sm flex items-center gap-2">\n                        <i class="fas fa-external-link-alt text-xs"></i>\n                        ${e.name||"Unnamed Resource"}\n                      </a>\n                      <div class="text-xs md:text-sm text-gray-600 dark:text-gray-400 mt-1 flex items-center gap-2">\n                        <span class="inline-flex items-center gap-1">\n                          <i class="fas fa-tag text-xs"></i>\n                          ${e.type||"Resource"}\n                        </span>\n                        <span class="text-gray-400">•</span>\n                        <span class="inline-flex items-center gap-1">\n                          <i class="fas fa-language text-xs"></i>\n                          ${e.language||"N/A"}\n                        </span>\n                      </div>\n                    </div>\n                  `).join("")}\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    </div>\n  `;a.insertAdjacentHTML("beforeend",s)},getFileIcon=e=>({pdf:"fas fa-file-pdf text-red-500",doc:"fas fa-file-word text-blue-600",docx:"fas fa-file-word text-blue-600",ppt:"fas fa-file-powerpoint text-orange-500",pptx:"fas fa-file-powerpoint text-orange-500",xls:"fas fa-file-excel text-green-500",xlsx:"fas fa-file-excel text-green-500",txt:"fas fa-file-alt text-gray-500",png:"fas fa-file-image text-yellow-500",jpg:"fas fa-file-image text-yellow-500",jpeg:"fas fa-file-image text-yellow-500",gif:"fas fa-file-image text-yellow-500",webp:"fas fa-file-image text-yellow-500",bmp:"fas fa-file-image text-yellow-500",mp4:"fas fa-file-video text-indigo-500",mov:"fas fa-file-video text-indigo-500",avi:"fas fa-file-video text-indigo-500",mkv:"fas fa-file-video text-indigo-500",wmv:"fas fa-file-video text-indigo-500",flv:"fas fa-file-video text-indigo-500",webm:"fas fa-file-video text-indigo-500",zip:"fas fa-file-archive text-purple-500",rar:"fas fa-file-archive text-purple-500","7z":"fas fa-file-archive text-purple-500",tar:"fas fa-file-archive text-purple-500",gz:"fas fa-file-archive text-purple-500",exe:"fas fa-cogs text-red-600",bat:"fas fa-terminal text-red-600",sh:"fas fa-terminal text-red-600",c:"fas fa-file-code text-blue-400",cpp:"fas fa-file-code text-blue-400",h:"fas fa-file-code text-blue-400",php:"fab fa-php text-purple-600",py:"fab fa-python text-blue-500",js:"fab fa-js-square text-yellow-400",ts:"fab fa-js-square text-blue-600",html:"fab fa-html5 text-orange-500",css:"fab fa-css3-alt text-blue-500",java:"fab fa-java text-red-500",rb:"fas fa-gem text-red-400",go:"fas fa-golang text-blue-400",rs:"fas fa-cogs text-orange-500",md:"fas fa-file-alt text-gray-700",json:"fas fa-file-code text-yellow-600",xml:"fas fa-file-code text-purple-400",csv:"fas fa-file-csv text-green-500"}[e.split(".").pop().toLowerCase()]||"fas fa-file text-gray-500"),openFolder=e=>{currentPath.push(e);const t=currentPath.join(">subfolders>");loadContent(currentYear,t)},openFile=e=>{e&&(currentFileIndex=currentFiles.findIndex(t=>t.name===e.name),e.previewLink?(document.getElementById("modalTitle").textContent=e.name,document.getElementById("fileViewer").src=e.previewLink,document.getElementById("fileModal").classList.add("active"),updateBodyScrollLock(),updateSwiperButtons()):window.open(e.link,"_blank"))},downloadFile=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},closeModal=()=>{document.getElementById("fileModal").classList.remove("active"),document.getElementById("fileViewer").src="",currentFileIndex=-1,updateBodyScrollLock()},closeYearModal=()=>{document.getElementById("yearModal").classList.remove("active"),updateBodyScrollLock(),currentPath=[],currentYear=""},toggleFullScreen=()=>{const e=document.getElementById("fileModal"),t=document.getElementById("fullscreenBtn"),n=t.querySelector("i");e.classList.toggle("fullscreen"),e.classList.contains("fullscreen")?(n.classList.remove("fa-expand"),n.classList.add("fa-compress"),t.title="Exit full screen"):(n.classList.remove("fa-compress"),n.classList.add("fa-expand"),t.title="Enter full screen")},updateBodyScrollLock=()=>{document.querySelectorAll(".modal.active").length>0?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")},showPrevFile=()=>{currentFileIndex>0&&(currentFileIndex--,openFile(currentFiles[currentFileIndex]))},showNextFile=()=>{currentFileIndex<currentFiles.length-1&&(currentFileIndex++,openFile(currentFiles[currentFileIndex]))},updateSwiperButtons=()=>{const e=document.getElementById("prevFileBtn"),t=document.getElementById("nextFileBtn");e.style.display=currentFileIndex<=0?"none":"block",currentFileIndex>=currentFiles.length-1?t.style.display="none":t.style.display="block"};loadYears();const yearsDropdownBtn=document.getElementById("yearsDropdownBtn"),yearsDropdown=document.getElementById("yearsDropdown");yearsDropdownBtn.addEventListener("click",e=>{e.stopPropagation(),yearsDropdown.classList.toggle("hidden")}),document.addEventListener("click",e=>{yearsDropdown.contains(e.target)||yearsDropdownBtn.contains(e.target)||yearsDropdown.classList.add("hidden")});const mobileBtn=document.getElementById("mobileMenuBtn"),mobileMenu=document.getElementById("mobileMenu");mobileBtn.addEventListener("click",()=>{mobileMenu.classList.contains("opacity-100")?(mobileMenu.classList.remove("opacity-100","scale-y-100","translate-y-0"),mobileMenu.classList.add("opacity-0","scale-y-95","-translate-y-2"),setTimeout(()=>{mobileMenu.classList.add("hidden")},180)):(mobileMenu.classList.remove("hidden"),setTimeout(()=>{mobileMenu.classList.remove("opacity-0","scale-y-95","-translate-y-2"),mobileMenu.classList.add("opacity-100","scale-y-100","translate-y-0")},10))});const mobileYearsBtn=document.getElementById("mobileYearsBtn"),mobileYearsDropdown=document.getElementById("mobileYearsDropdown");mobileYearsBtn.addEventListener("click",e=>{e.stopPropagation(),mobileYearsDropdown.classList.toggle("hidden")}),document.addEventListener("click",e=>{mobileYearsDropdown.contains(e.target)||mobileYearsBtn.contains(e.target)||mobileYearsDropdown.classList.add("hidden")});const backToTopBtn=document.getElementById("backToTop");window.addEventListener("scroll",()=>{window.scrollY>300?(backToTopBtn.classList.remove("opacity-0","pointer-events-none"),backToTopBtn.classList.add("opacity-100")):(backToTopBtn.classList.add("opacity-0","pointer-events-none"),backToTopBtn.classList.remove("opacity-100"))}),backToTopBtn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});const GOOGLE_APPS_SCRIPT_URL="https://script.google.com/macros/s/AKfycbzmfa0TDm_Ec9CtZSpSvIv7knXucmv_67xyh6APXDnsdMnb-0NukESFq58ZbVlm0GqEcg/exec",initContactForm=()=>{const e=document.getElementById("contactForm"),t=document.getElementById("submitBtn"),n=document.getElementById("loading"),a=document.getElementById("responseMessage");if(!e)return;e.addEventListener("submit",async o=>{o.preventDefault();const l=document.getElementById("name").value.trim(),i=document.getElementById("email").value.trim(),r=document.getElementById("message").value.trim();if(l&&i&&r){t.disabled=!0,n.classList.remove("hidden"),n.classList.add("flex"),a.classList.add("hidden");try{await fetch(GOOGLE_APPS_SCRIPT_URL,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({name:l,email:i,message:r})}),s("Message sent successfully!","success"),e.reset()}catch(e){s("Failed to send message. Please try again.","error"),console.error("Error:",e)}finally{t.disabled=!1,n.classList.add("hidden"),n.classList.remove("flex")}}else s("All fields required","error")});const s=(e,t)=>{a.textContent=e,a.classList.remove("hidden"),"success"===t?(a.className="p-2.5 rounded mt-2.5 bg-green-100 text-green-800 border border-green-200 dark:bg-green-900 dark:text-green-200 dark:border-green-800",setTimeout(()=>{a.classList.add("hidden")},5e3)):a.className="p-2.5 rounded mt-2.5 bg-red-100 text-red-800 border border-red-200 dark:bg-red-900 dark:text-red-200 dark:border-red-800"}},closeContributorsModal=()=>{const e=document.getElementById("contributorsModal");e&&(e.style.display="none")},switchContributorTab=e=>{document.querySelectorAll(".contributor-tab").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Tab");t&&t.classList.add("active");document.querySelectorAll(".tab-content").forEach(e=>e.classList.add("hidden"));const n=document.getElementById(e+"Content");n&&n.classList.remove("hidden")},openContributorsModal=()=>{const e=document.getElementById("contributorsModal");e&&(e.style.display="flex")},dhikr=["أستغفر اللّه","سبحان اللّه","الحمد للّه","لا إله إلا اللّه","اللّه أكبر","سبحان اللّه وبحمده","سبحان اللّه العظيم","لا حول ولا قوة إلا باللّه","اللّهم صل وسلم على نبينا محمد","لا إله إلا أنت سبحانك إني كنت من الظالمين","ربي اغفر لي ولوالدي وللمؤمنين","اللّه أكبر كبيرا","سبحان الله بكرة واصيلا","الحمد لله رب العالمين","أستغفر الله وأتوب إليه","إنّا لله وإنّا إليه راجعون","اللّهُمَّ إني أسألك الجنة","اللّهُمَّ إني أعوذ بك من النار","سبحانك اللهم وبحمدك","اللهم إني أسألك علمًا نافعًا","اللهم إني أسألك الهدى و التقى و العفاف و الغنى","3 x اعوذ بكلمات الله التامات من شر ما خلق","اللهم لاسهل إلا ماجعلته سهلا وأنت تجعل الحزن إذا شئت سهلا","اللهم اغفر لي ذنبي كله دقه وجله وأوله وآخره وعلانيته وسره","اللهم اني اعوذ بك من الهم والحزن"],box=document.getElementById("dhikrBox"),text=document.getElementById("dhikrText");function showRandomDhikr(){const e=dhikr[Math.floor(Math.random()*dhikr.length)];text.textContent=e,box.style.display="block",setTimeout(()=>box.style.opacity=1,10)}function hideDhikr(){box.style.opacity=0,setTimeout(()=>{box.style.display="none"},700)}box.addEventListener("click",hideDhikr),document.addEventListener("DOMContentLoaded",()=>{initContactForm(),showRandomDhikr()});