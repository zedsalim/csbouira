const toggleDarkMode=()=>{document.documentElement.classList.toggle("dark"),document.querySelectorAll(".dark-mode-icon").forEach(e=>{e.classList.toggle("fa-moon"),e.classList.toggle("fa-sun")}),localStorage.setItem("darkMode",document.documentElement.classList.contains("dark"))};"true"===localStorage.getItem("darkMode")&&(document.documentElement.classList.add("dark"),document.querySelectorAll(".dark-mode-icon").forEach(e=>{e.classList.remove("fa-moon"),e.classList.add("fa-sun")}));const API_BASE="https://api.csbouira.xyz/api/drive";let currentPath=[],currentYear="";const loadYears=async()=>{try{let e=await fetch(API_BASE);await e.json();let t=["Licence 1","Licence 2","Licence 3 SI"],a=["Master 1 GSI","Master 1 ISIL","Master 1 IA"],s=["Master 2 GSI","Master 2 ISIL","Master 2 IA"];renderYearCards(t,"licence-cards","fas fa-book-open"),renderYearCards(a,"master1-cards","fas fa-graduation-cap"),renderYearCards(s,"master2-cards","fas fa-user-graduate")}catch(l){console.error("Error loading years:",l)}},renderYearCards=(e,t,a)=>{let s=document.getElementById(t);s.innerHTML=e.map(e=>`
        <div class="card p-6 cursor-pointer" onclick="openYear('${e}')">
          <div class="flex items-center gap-4 mb-4">
            <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center">
              <i class="${a} text-white text-xl"></i>
            </div>
            <h3 class="text-xl font-semibold">${e}</h3>
          </div>
          <p class="text-sm" style="color: var(--text-secondary-light);">
            Click to explore semesters and modules
          </p>
          <div class="mt-4 flex items-center text-blue-500 font-semibold">
            View Resources <i class="fas fa-arrow-right ml-2"></i>
          </div>
        </div>
      `).join("")},openYear=async(e,t)=>{t&&t.preventDefault(),currentYear=e,currentPath=[e],document.getElementById("yearModalTitle").textContent=e,document.getElementById("yearModal").classList.add("active"),await loadContent(e)},loadContent=async(e,t="")=>{let a=document.getElementById("yearContent");a.innerHTML=`
    <div class="text-center py-8">
      <div class="loading mx-auto"></div>
      <p class="mt-4">Loading...</p>
    </div>
  `;try{let s=`${API_BASE}?year=${encodeURIComponent(e)}`;t&&(s=`${API_BASE}?path=${encodeURIComponent(t)}`);let l=await fetch(s),i=await l.json();updateBreadcrumb(),renderContent(i)}catch(r){a.innerHTML=`
      <div class="empty-state">
        <i class="fas fa-exclamation-circle text-6xl text-red-500 mb-4"></i>
        <p class="text-xl">Error loading content</p>
        <p class="mt-2">${r.message}</p>
      </div>
    `}},updateBreadcrumb=()=>{let e=document.getElementById("breadcrumb");e.innerHTML=currentPath.map((e,t)=>`
        <span class="breadcrumb-item ${t===currentPath.length-1?"active":""}" onclick="navigateToBreadcrumb(${t})">
          ${e}
          ${t<currentPath.length-1?'<i class="fas fa-chevron-right mx-2"></i>':""}
        </span>
      `).join("")},navigateToBreadcrumb=e=>{currentPath=currentPath.slice(0,e+1);let t=currentPath.join(">subfolders>");loadContent(currentYear,t)},renderContent=e=>{let t=document.getElementById("yearContent");if((!e.subfolders||0===Object.keys(e.subfolders).length)&&(!e.files||0===e.files.length)){t.innerHTML=`
      <div class="empty-state">
        <i class="fas fa-folder-open text-6xl mb-4" style="color: var(--text-secondary-light);"></i>
        <p class="text-xl">No content available</p>
      </div>
    `;return}let a="";if(e.subfolders&&Object.keys(e.subfolders).length>0){a+=`
      <div class="mb-6">
        <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
          <i class="fas fa-folder text-yellow-500"></i>Folders
        </h3>
        <div class="space-y-2">
    `;let s=Object.entries(e.subfolders).reverse();for(let[l]of s){let i=l.includes("(empty)"),r=l.replace(/'/g,"\\'").replace(/"/g,'\\"');a+=`
        <div class="folder-item ${i?"opacity-50":""}" ${i?"":`onclick="openFolder('${r}')"`}>
          <i class="fas fa-folder text-yellow-500"></i>
          <span class="flex-1">${l}</span>
          ${i?'<span class="text-sm">(empty)</span>':'<i class="fas fa-chevron-right"></i>'}
        </div>
      `}a+="</div></div>"}e.files&&e.files.length>0&&(a+=`
      <div>
        <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
          <i class="fas fa-file text-blue-500"></i>Files
        </h3>
        <div class="space-y-2">
    `,e.files.forEach(e=>{let t=getFileIcon(e.name);a+=`
        <div class="file-item" onclick='openFile(${JSON.stringify(e)})'>
          <i class="${t}"></i>
          <span class="flex-1">${e.name}</span>
          <i class="fas fa-external-link-alt"></i>
        </div>
      `}),a+="</div></div>"),t.innerHTML=a},getFileIcon=e=>{let t=e.split(".").pop().toLowerCase(),a={pdf:"fas fa-file-pdf text-red-500",doc:"fas fa-file-word text-blue-600",docx:"fas fa-file-word text-blue-600",ppt:"fas fa-file-powerpoint text-orange-500",pptx:"fas fa-file-powerpoint text-orange-500",xls:"fas fa-file-excel text-green-500",xlsx:"fas fa-file-excel text-green-500",txt:"fas fa-file-alt text-gray-500",png:"fas fa-file-image text-yellow-500",jpg:"fas fa-file-image text-yellow-500",jpeg:"fas fa-file-image text-yellow-500",gif:"fas fa-file-image text-yellow-500",webp:"fas fa-file-image text-yellow-500",bmp:"fas fa-file-image text-yellow-500",mp4:"fas fa-file-video text-indigo-500",mov:"fas fa-file-video text-indigo-500",avi:"fas fa-file-video text-indigo-500",mkv:"fas fa-file-video text-indigo-500",wmv:"fas fa-file-video text-indigo-500",flv:"fas fa-file-video text-indigo-500",webm:"fas fa-file-video text-indigo-500",zip:"fas fa-file-archive text-purple-500",rar:"fas fa-file-archive text-purple-500","7z":"fas fa-file-archive text-purple-500",tar:"fas fa-file-archive text-purple-500",gz:"fas fa-file-archive text-purple-500",exe:"fas fa-cogs text-red-600",bat:"fas fa-terminal text-red-600",sh:"fas fa-terminal text-red-600",c:"fas fa-file-code text-blue-400",cpp:"fas fa-file-code text-blue-400",h:"fas fa-file-code text-blue-400",php:"fab fa-php text-purple-600",py:"fab fa-python text-blue-500",js:"fab fa-js-square text-yellow-400",ts:"fab fa-js-square text-blue-600",html:"fab fa-html5 text-orange-500",css:"fab fa-css3-alt text-blue-500",java:"fab fa-java text-red-500",rb:"fas fa-gem text-red-400",go:"fas fa-golang text-blue-400",rs:"fas fa-cogs text-orange-500",md:"fas fa-file-alt text-gray-700",json:"fas fa-file-code text-yellow-600",xml:"fas fa-file-code text-purple-400",csv:"fas fa-file-csv text-green-500"};return a[t]||"fas fa-file text-gray-500"},openFolder=e=>{currentPath.push(e);let t=currentPath.join(">subfolders>");loadContent(currentYear,t)},openFile=e=>{let t=extractFileId(e.link);if(t){let a=`https://drive.google.com/file/d/${t}/preview`;document.getElementById("modalTitle").textContent=e.name,document.getElementById("fileViewer").src=a,document.getElementById("fileModal").classList.add("active")}else window.open(e.link,"_blank")},extractFileId=e=>{let t=e.match(/\/d\/([^/]+)/);return t?t[1]:null},closeModal=()=>{document.getElementById("fileModal").classList.remove("active"),document.getElementById("fileViewer").src=""},closeYearModal=()=>{document.getElementById("yearModal").classList.remove("active"),currentPath=[],currentYear=""};loadYears();const yearsDropdownBtn=document.getElementById("yearsDropdownBtn"),yearsDropdown=document.getElementById("yearsDropdown");yearsDropdownBtn.addEventListener("click",e=>{e.stopPropagation(),yearsDropdown.classList.toggle("hidden")}),document.addEventListener("click",e=>{yearsDropdown.contains(e.target)||yearsDropdownBtn.contains(e.target)||yearsDropdown.classList.add("hidden")});const mobileBtn=document.getElementById("mobileMenuBtn"),mobileMenu=document.getElementById("mobileMenu");mobileBtn.addEventListener("click",()=>{let e=mobileMenu.classList.contains("opacity-100");e?(mobileMenu.classList.remove("opacity-100","scale-y-100","translate-y-0"),mobileMenu.classList.add("opacity-0","scale-y-95","-translate-y-2"),setTimeout(()=>{mobileMenu.classList.add("hidden")},180)):(mobileMenu.classList.remove("hidden"),setTimeout(()=>{mobileMenu.classList.remove("opacity-0","scale-y-95","-translate-y-2"),mobileMenu.classList.add("opacity-100","scale-y-100","translate-y-0")},10))});const mobileYearsBtn=document.getElementById("mobileYearsBtn"),mobileYearsDropdown=document.getElementById("mobileYearsDropdown");mobileYearsBtn.addEventListener("click",e=>{e.stopPropagation(),mobileYearsDropdown.classList.toggle("hidden")}),document.addEventListener("click",e=>{mobileYearsDropdown.contains(e.target)||mobileYearsBtn.contains(e.target)||mobileYearsDropdown.classList.add("hidden")});const backToTopBtn=document.getElementById("backToTop");window.addEventListener("scroll",()=>{window.scrollY>300?(backToTopBtn.classList.remove("opacity-0","pointer-events-none"),backToTopBtn.classList.add("opacity-100")):(backToTopBtn.classList.add("opacity-0","pointer-events-none"),backToTopBtn.classList.remove("opacity-100"))}),backToTopBtn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});
